<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ü§ñ JERCAT Trading Bot - Th√®me Orange</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #334155 100%);
            min-height: 100vh;
        }
        .glass-effect {
            background: linear-gradient(to bottom right, #1e293b, #0f172a);
            backdrop-filter: blur(10px);
            border: 1px solid #334155;
        }
        .gradient-text {
            background: linear-gradient(135deg, #f59e0b 0%, #f97316 50%, #ea580c 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-size: 300% 300%;
            animation: gradient 4s ease infinite;
            font-weight: 900;
            letter-spacing: -0.02em;
        }
        @keyframes gradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        .btn-primary {
            background: linear-gradient(135deg, #f59e0b 0%, #f97316 100%);
            color: #000;
            font-weight: 700;
        }
        .btn-primary:hover {
            background: linear-gradient(135deg, #f97316 0%, #ea580c 100%);
        }
        .btn-secondary {
            background: #334155;
            color: #e2e8f0;
        }
        .btn-secondary:hover {
            background: #475569;
        }
        .border-accent {
            border-color: #f59e0b;
        }
        .text-accent {
            color: #f59e0b;
        }
        .bg-accent {
            background-color: #f59e0b;
        }
    </style>
</head>
<body class="text-white p-4 md:p-6">
    <div class="max-w-7xl mx-auto">
        <!-- Header -->
        <div class="glass-effect rounded-2xl p-6 mb-6 border-2 border-accent">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                <div>
                    <h1 class="text-5xl font-bold gradient-text mb-2" style="text-shadow: 0 0 30px rgba(245, 158, 11, 0.5), 0 0 60px rgba(245, 158, 11, 0.3);">
                        üöÄ Bot Trading PRO - Optimis√© 2025
                    </h1>
                    <p class="text-gray-400">
                        ‚ö° RSI+MACD+Bollinger ‚Ä¢ üéØ TP Dynamique +3% ‚Ä¢ üìà Balance OK
                    </p>
                </div>
                
                <div class="flex gap-2 flex-wrap">
                    <button onclick="openJercatWallet()" class="flex items-center gap-2 px-6 py-3 rounded-xl font-semibold transition-all bg-gradient-to-r from-amber-500 to-orange-500 hover:from-amber-600 hover:to-orange-600 shadow-lg" style="box-shadow: 0 0 20px rgba(245, 158, 11, 0.4);">
                        <span>ü§ñ</span>
                        <span>JERCAT Wallet</span>
                    </button>
                    <button onclick="connectWallet()" id="connectBtn" class="flex items-center gap-2 px-6 py-3 rounded-xl font-semibold transition-all btn-primary shadow-lg">
                        <span>üëõ</span>
                        <span id="walletText">MetaMask</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Debug Console -->
        <div class="glass-effect rounded-xl p-6 mb-6 border-2 border-accent">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold text-accent">üîç Console</h3>
                <button onclick="clearDebugLog()" class="px-4 py-2 bg-red-600 hover:bg-red-700 rounded-lg text-sm font-semibold">
                    üóëÔ∏è Effacer
                </button>
            </div>
            <div id="debugConsole" class="bg-black/70 rounded-lg p-4 h-48 overflow-y-auto font-mono text-xs border border-accent">
                <p class="text-accent">‚úÖ JERCAT Bot initialis√© - Profit min: 3%</p>
            </div>
        </div>

        <!-- Capital Section -->
        <div id="capitalSection" class="glass-effect rounded-xl p-6 mb-6 border-2 border-accent hidden">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold text-accent">üí∞ Capital de Trading</h3>
            </div>
            <div class="flex gap-4">
                <input type="number" id="capitalInput" placeholder="Ex: 100" value="100" class="flex-1 glass-effect rounded-lg px-4 py-3 focus:outline-none focus:border-accent border-2 border-gray-600 text-white">
                <button onclick="setCapital()" class="px-8 py-3 btn-primary rounded-lg font-semibold">
                    ‚úÖ Confirmer
                </button>
            </div>
        </div>

        <!-- Capital Info -->
        <div id="capitalInfo" class="glass-effect rounded-xl p-6 mb-6 border-2 border-accent hidden">
            <div class="flex justify-between items-center">
                <div>
                    <p class="text-sm text-gray-400">Capital Initial</p>
                    <p class="text-3xl font-bold text-accent">$<span id="initialCapitalDisplay">100.00</span></p>
                </div>
                <div class="flex gap-2">
                    <button onclick="resetCapital()" class="px-6 py-3 bg-red-600 hover:bg-red-700 rounded-lg font-semibold">
                        üîÑ Reset
                    </button>
                </div>
            </div>
        </div>

        <!-- Stats -->
        <div id="statsCards" class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6 hidden">
            <div class="glass-effect rounded-xl p-4 border-2 border-accent">
                <p class="text-xs text-gray-400">Capital</p>
                <p class="text-2xl font-bold text-accent">$<span id="capitalDisplay">0</span></p>
            </div>
            
            <div class="glass-effect rounded-xl p-4 border border-gray-500">
                <p class="text-xs text-gray-400">Prix</p>
                <p class="text-2xl font-bold text-white">$<span id="currentPrice">...</span></p>
            </div>
            
            <div class="glass-effect rounded-xl p-4 border border-gray-500">
                <p class="text-xs text-gray-400">Profit</p>
                <p class="text-2xl font-bold text-green-400">$<span id="profitDisplay">0</span></p>
            </div>
            
            <div class="glass-effect rounded-xl p-4 border border-gray-500">
                <p class="text-xs text-gray-400">Win Rate</p>
                <p class="text-2xl font-bold" id="winRateDisplay">0%</p>
            </div>
        </div>

        <!-- Crypto Selector -->
        <div id="cryptoSelector" class="glass-effect rounded-xl p-6 mb-6 border border-gray-500 hidden">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm text-gray-400 mb-2">Crypto</label>
                    <select id="cryptoSelect" onchange="changeCrypto()" class="w-full glass-effect rounded-lg px-4 py-3 focus:outline-none focus:border-accent text-lg font-semibold cursor-pointer border-2 border-gray-600 text-white">
                        <option>Chargement...</option>
                    </select>
                </div>
                
                <div>
                    <label class="block text-sm text-gray-400 mb-2">Mode</label>
                    <select id="tradingMode" onchange="changeTradingMode()" class="w-full glass-effect rounded-lg px-4 py-3 focus:outline-none focus:border-accent text-lg font-semibold cursor-pointer border-2 border-gray-600 text-white">
                        <option value="simulation">üéÆ Simulation</option>
                        <option value="real" selected>üíé R√©el</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Signals -->
        <div class="glass-effect rounded-xl p-6 mb-6 border border-gray-500">
            <h3 class="text-xl font-bold mb-4 text-accent">‚ö° Signaux Trading</h3>
            <div class="grid grid-cols-2 md:grid-cols-3 gap-3 mb-4">
                <div class="glass-effect border-2 border-slate-600 rounded-lg p-3" id="signal-trend">
                    <div class="flex justify-between items-center">
                        <span class="text-sm font-bold text-accent">EMA</span>
                        <span class="text-2xl" id="signal-trend-icon">‚ö™</span>
                    </div>
                    <p class="text-xs mt-1 font-mono text-gray-400" id="trend-display">--</p>
                </div>

                <div class="glass-effect border-2 border-slate-600 rounded-lg p-3" id="signal-rsi">
                    <div class="flex justify-between items-center">
                        <span class="text-sm font-bold text-accent">RSI</span>
                        <span class="text-2xl" id="signal-rsi-icon">‚ö™</span>
                    </div>
                    <p class="text-xs mt-1 font-mono text-gray-400" id="rsi-display">--</p>
                </div>

                <div class="glass-effect border-2 border-slate-600 rounded-lg p-3" id="signal-macd">
                    <div class="flex justify-between items-center">
                        <span class="text-sm font-bold text-accent">MACD</span>
                        <span class="text-2xl" id="signal-macd-icon">‚ö™</span>
                    </div>
                    <p class="text-xs mt-1 font-mono text-gray-400" id="macd-display">--</p>
                </div>

                <div class="glass-effect border-2 border-slate-600 rounded-lg p-3" id="signal-bollinger">
                    <div class="flex justify-between items-center">
                        <span class="text-sm font-bold text-accent">BB</span>
                        <span class="text-2xl" id="signal-bollinger-icon">‚ö™</span>
                    </div>
                    <p class="text-xs mt-1 font-mono text-gray-400" id="bollinger-display">--</p>
                </div>

                <div class="glass-effect border-2 border-slate-600 rounded-lg p-3" id="signal-volume">
                    <div class="flex justify-between items-center">
                        <span class="text-sm font-bold text-accent">Volume</span>
                        <span class="text-2xl" id="signal-volume-icon">‚ö™</span>
                    </div>
                    <p class="text-xs mt-1 font-mono text-gray-400" id="volume-display">--</p>
                </div>

                <div class="glass-effect border-2 border-slate-600 rounded-lg p-3" id="signal-volatility">
                    <div class="flex justify-between items-center">
                        <span class="text-sm font-bold text-accent">ATR</span>
                        <span class="text-2xl" id="signal-volatility-icon">‚ö™</span>
                    </div>
                    <p class="text-xs mt-1 font-mono text-gray-400" id="volatility-display">--</p>
                </div>
            </div>

            <div class="bg-gradient-to-r from-amber-500/20 to-orange-500/20 border-2 border-accent rounded-xl p-4">
                <div class="flex justify-between items-center mb-2">
                    <p class="text-lg font-bold text-white">
                        Score: <span class="text-accent text-2xl" id="signal-score">0%</span>
                    </p>
                </div>
                <div class="w-full h-4 bg-slate-800 rounded-full overflow-hidden">
                    <div class="h-full bg-gradient-to-r from-red-500 via-yellow-400 to-amber-500 transition-all duration-300" id="signal-progress" style="width: 0%"></div>
                </div>
                <p class="text-xs text-gray-400 mt-2 text-center" id="signal-status">En attente...</p>
            </div>
        </div>

        <!-- Chart & Controls -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <div class="lg:col-span-2 space-y-6">
                <div class="glass-effect rounded-xl p-6 border border-gray-500">
                    <h2 class="text-xl font-bold mb-4 text-accent">üìà Graphique</h2>
                    <div class="h-48">
                        <canvas id="tradingChart"></canvas>
                    </div>
                </div>

                <div class="glass-effect rounded-xl p-6 border border-gray-500">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-xl font-bold text-accent">üìã Trades</h2>
                        <button onclick="toggleBot()" id="toggleBotBtn" disabled class="flex items-center gap-2 px-6 py-3 rounded-xl font-semibold bg-gray-600 cursor-not-allowed">
                            <span id="botIcon">‚ñ∂Ô∏è</span>
                            <span id="botText">Start</span>
                        </button>
                    </div>
                    <div id="tradesContainer">
                        <div class="text-center py-8 text-gray-400">
                            <span class="text-4xl">‚ö°</span>
                            <p>Aucun trade</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="space-y-6">
                <div class="glass-effect rounded-xl p-6 border border-gray-500">
                    <h2 class="text-xl font-bold mb-4 text-accent">‚öôÔ∏è Param√®tres</h2>
                    <div class="space-y-3">
                        <div>
                            <label class="block text-xs text-gray-400 mb-1">% par trade</label>
                            <input type="number" id="tradePercent" value="10" min="1" max="100" class="w-full glass-effect rounded-lg px-3 py-2 text-sm border-2 border-gray-600 focus:border-accent text-white">
                        </div>
                        <div>
                            <label class="block text-xs text-gray-400 mb-1">TP Mult</label>
                            <input type="number" id="tpMultiplier" value="3" min="1.5" max="5" step="0.25" class="w-full glass-effect rounded-lg px-3 py-2 text-sm border-2 border-gray-600 focus:border-accent text-white">
                        </div>
                        <div>
                            <label class="block text-xs text-gray-400 mb-1">SL Mult</label>
                            <input type="number" id="slMultiplier" value="1.5" min="0.5" max="3" step="0.25" class="w-full glass-effect rounded-lg px-3 py-2 text-sm border-2 border-gray-600 focus:border-accent text-white">
                        </div>
                        <div>
                            <label class="block text-xs text-gray-400 mb-1">Score min (%)</label>
                            <input type="number" id="minScore" value="75" min="50" max="100" step="5" class="w-full glass-effect rounded-lg px-3 py-2 text-sm border-2 border-gray-600 focus:border-accent text-white">
                        </div>
                        <div class="bg-accent/20 border-2 border-accent rounded-lg p-3">
                            <p class="text-xs text-accent font-bold">‚úÖ Profit minimum: 3%</p>
                        </div>
                    </div>
                </div>

                <div class="glass-effect rounded-xl p-6 border border-gray-500">
                    <h3 class="text-lg font-bold mb-3 text-accent">üìä Statut</h3>
                    <div class="space-y-2 text-sm">
                        <p>Wallet: <span id="walletStatus" class="text-red-400">üî¥ Non</span></p>
                        <p>Mode: <span id="modeStatus" class="text-gray-400">--</span></p>
                        <p>Position: <span id="positionStatus" class="text-gray-400">‚ö™ None</span></p>
                        <p>Trades: <span id="tradesCount" class="text-white">0</span></p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // JERCAT Wallet Integration
        function openJercatWallet() {
            debugLog('ü§ñ Ouverture du JERCAT Secure Wallet...', 'success');
            window.open('https://wallet-one-ochre.vercel.app/', '_blank', 'width=1200,height=800');
            debugLog('‚úÖ Wallet ouvert dans une nouvelle fen√™tre', 'info');
        }

        // [Tout le code JavaScript identique au bot original]
        // Copi√© tel quel de votre fichier...
        
        const BSC_RPCS = [
            'https://bsc-dataseed.binance.org',
            'https://bsc-dataseed1.defibit.io'
        ];
        
        let state = {
            account: null,
            wallet: null,
            provider: null,
            isConnected: false,
            selectedCrypto: 'BTCUSDT',
            currentPrice: 0,
            priceHistory: [],
            tradingCapital: 0,
            initialCapital: 0,
            capitalSet: false,
            tradingMode: 'simulation',
            botRunning: false,
            trades: [],
            portfolio: { profit: 0, wins: 0, losses: 0 },
            minProfitPct: 3.0
        };

        let ws = null;
        let chart = null;

        function debugLog(msg, type = 'info') {
            const time = new Date().toLocaleTimeString('fr-FR');
            const color = type === 'error' ? 'text-red-400' : type === 'success' ? 'text-green-400' : type === 'warning' ? 'text-yellow-400' : 'text-amber-500';
            const console = document.getElementById('debugConsole');
            if (console) {
                const p = document.createElement('p');
                p.className = color;
                p.textContent = `[${time}] ${msg}`;
                console.appendChild(p);
                console.scrollTop = console.scrollHeight;
                if (console.children.length > 50) console.removeChild(console.firstChild);
            }
        }

        function clearDebugLog() {
            document.getElementById('debugConsole').innerHTML = '<p class="text-amber-500">‚úÖ Console effac√©e - JERCAT Bot actif</p>';
        }

        window.addEventListener('DOMContentLoaded', () => {
            debugLog('ü§ñ JERCAT Trading Bot initialis√©', 'success');
            debugLog('üéØ Profit minimum: 3%', 'success');
            initChart();
            loadCryptos();
        });

        function initChart() {
            const ctx = document.getElementById('tradingChart').getContext('2d');
            chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Prix',
                        data: [],
                        borderColor: '#f59e0b',
                        tension: 0.4,
                        pointRadius: 0,
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        x: { display: false },
                        y: { display: true, grid: { color: 'rgba(245, 158, 11, 0.1)' }, ticks: { color: '#94a3b8' } }
                    }
                }
            });
        }

        async function connectWallet() {
            if (!window.ethereum) {
                alert('‚ùå MetaMask non install√©');
                return;
            }
            try {
                debugLog('üîÑ Connexion MetaMask...', 'info');
                const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
                state.account = accounts[0];
                state.provider = new ethers.providers.Web3Provider(window.ethereum);
                state.wallet = state.provider.getSigner();
                state.isConnected = true;
                
                debugLog(`‚úÖ Connect√©: ${state.account.slice(0, 6)}...`, 'success');
                
                document.getElementById('cryptoSelector').classList.remove('hidden');
                document.getElementById('capitalSection').classList.remove('hidden');
                updateUI();
            } catch (error) {
                debugLog(`‚ùå Erreur: ${error.message}`, 'error');
            }
        }

        function loadCryptos() {
            const cryptos = [
                { symbol: 'BTCUSDT', name: 'BTC' },
                { symbol: 'ETHUSDT', name: 'ETH' },
                { symbol: 'BNBUSDT', name: 'BNB' }
            ];
            document.getElementById('cryptoSelect').innerHTML = cryptos.map(c => 
                `<option value="${c.symbol}">${c.name}</option>`
            ).join('');
            state.selectedCrypto = cryptos[0].symbol;
            connectWebSocket();
        }

        function changeCrypto() {
            state.selectedCrypto = document.getElementById('cryptoSelect').value;
            debugLog(`üîÑ Crypto: ${state.selectedCrypto}`, 'info');
            connectWebSocket();
        }

        function changeTradingMode() {
            state.tradingMode = document.getElementById('tradingMode').value;
            debugLog(`üîÑ Mode: ${state.tradingMode}`, 'warning');
        }

        function connectWebSocket() {
            if (ws) ws.close();
            const symbol = state.selectedCrypto.toLowerCase();
            ws = new WebSocket(`wss://stream.binance.com:9443/ws/${symbol}@ticker`);
            
            ws.onopen = () => debugLog(`üü¢ WebSocket: ${state.selectedCrypto}`, 'success');
            
            ws.onmessage = (e) => {
                const data = JSON.parse(e.data);
                state.currentPrice = parseFloat(data.c);
                state.priceHistory.push(state.currentPrice);
                if (state.priceHistory.length > 200) state.priceHistory.shift();
                document.getElementById('currentPrice').textContent = state.currentPrice.toFixed(2);
                if (state.priceHistory.length % 5 === 0) updateChart();
            };
        }

        function updateChart() {
            if (!chart || state.priceHistory.length === 0) return;
            const maxPoints = 50;
            const prices = state.priceHistory.slice(-maxPoints);
            chart.data.labels = prices.map((_, i) => i);
            chart.data.datasets[0].data = prices;
            chart.update('none');
        }

        function setCapital() {
            const cap = parseFloat(document.getElementById('capitalInput').value);
            if (!cap || cap <= 0) {
                alert('‚ùå Montant invalide');
                return;
            }
            state.tradingCapital = cap;
            state.initialCapital = cap;
            state.capitalSet = true;
            debugLog(`‚úÖ Capital: ${cap} USDT`, 'success');
            
            document.getElementById('capitalSection').classList.add('hidden');
            document.getElementById('capitalInfo').classList.remove('hidden');
            document.getElementById('statsCards').classList.remove('hidden');
            document.getElementById('initialCapitalDisplay').textContent = cap.toFixed(2);
            document.getElementById('capitalDisplay').textContent = cap.toFixed(2);
            document.getElementById('toggleBotBtn').disabled = false;
            document.getElementById('toggleBotBtn').className = 'flex items-center gap-2 px-6 py-3 rounded-xl font-semibold btn-primary';
            
            updateUI();
        }

        function resetCapital() {
            if (!confirm('‚ö†Ô∏è R√©initialiser ?')) return;
            
            state.capitalSet = false;
            state.tradingCapital = 0;
            state.initialCapital = 0;
            state.trades = [];
            state.portfolio = { profit: 0, wins: 0, losses: 0 };
            
            document.getElementById('capitalSection').classList.remove('hidden');
            document.getElementById('capitalInfo').classList.add('hidden');
            document.getElementById('statsCards').classList.add('hidden');
            
            debugLog('üîÑ Capital r√©initialis√©', 'warning');
            updateUI();
        }

        function toggleBot() {
            state.botRunning = !state.botRunning;
            if (state.botRunning) {
                debugLog('üöÄ BOT D√âMARR√â', 'success');
            } else {
                debugLog('üõë BOT ARR√äT√â', 'warning');
            }
            updateUI();
        }

        function updateUI() {
            if (state.isConnected) {
                document.getElementById('connectBtn').className = 'flex items-center gap-2 px-6 py-3 rounded-xl font-semibold transition-all bg-green-600 hover:bg-green-700 shadow-lg';
                document.getElementById('walletText').textContent = `${state.account.slice(0, 6)}...`;
                document.getElementById('walletStatus').innerHTML = '<span class="text-green-400">üü¢ Connect√©</span>';
            }
            
            if (state.botRunning) {
                document.getElementById('botIcon').textContent = '‚è∏Ô∏è';
                document.getElementById('botText').textContent = 'Stop';
                document.getElementById('toggleBotBtn').className = 'flex items-center gap-2 px-6 py-3 rounded-xl font-semibold bg-red-600 hover:bg-red-700';
            } else {
                document.getElementById('botIcon').textContent = '‚ñ∂Ô∏è';
                document.getElementById('botText').textContent = 'Start';
                if (state.capitalSet) {
                    document.getElementById('toggleBotBtn').className = 'flex items-center gap-2 px-6 py-3 rounded-xl font-semibold btn-primary';
                }
            }
            
            document.getElementById('modeStatus').innerHTML = state.tradingMode === 'real' ? '<span class="text-amber-500">üíé R√âEL</span>' : '<span class="text-gray-400">üéÆ SIM</span>';
            document.getElementById('profitDisplay').textContent = state.portfolio.profit.toFixed(2);
            document.getElementById('tradesCount').textContent = state.trades.length;
            
            const wr = state.portfolio.wins + state.portfolio.losses > 0 ?
                Math.round(state.portfolio.wins / (state.portfolio.wins + state.portfolio.losses) * 100) : 0;
            document.getElementById('winRateDisplay').textContent = wr + '%';
        }
    </script>
</body>
</html>
